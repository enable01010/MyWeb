# 授業目的
今回の授業ではオンラインを絡めたゲームを作成する事で、<br>
ネットワークを絡めたプログラムを学んで行きます。<br>

# Photonについて
フォトンとはUnityベースで動く、ネットワーク用の機能の事です。<br>
本格的にゲームを作る際はオンラインの使用料がかかるので注意しましょう。<br>
みなさんが、学校で作る範囲内で無料範囲を超えるほどの通信はないと思いますが、、、<br>
<br>
<br>
また、フォトンを使う際は本来アカウント登録をして、そこで作られるキーをUnityで登録する必要があります。<br>
今回は私のアカウントを使って行いますが、自分たちで行う場合はその設定がいります。<br>
詳しく知りたい方は下記の参考サイトを見てみるといいと思います。<br>
https://zenn.dev/o8que/books/bdcb9af27bdd7d

# プロジェクトの準備
Unity6000　Universal2D　PhotonNet　というプロジェクトを立ち上げてください。<br>
<img src="Image/Photon/CreateProject.png"><br>

# データのダウンロード
ギガファイル便にて本日使う資料のアップロードしましたので下記のリンクからダウンロードして下さい。<br>
https://44.gigafile.nu/1116-b091b2ac1ef910c0f466e9c0313b065e5 <br>

ダウンロードとプロジェクトの立ち上げが完了したら、<br>
ダウンロードしたフォルダーを解凍して、プロジェクトの中にいれてください。<br>
そして、いつもの如くTextMeshProのインポートとSceneの登録をしてください。<br>

# ネットワークにおける大切な考え方
ネットワークでゲームを作るうえで大切になる考え方が３つあります<br>
・どうやって出会うのか<br>
・何を同期するのか<br>
・誰が処理するのか<br>

# どうやって出会うのか
一番簡単なのは、部屋を作る事です。<br>
一人が部屋を作り、それ以外の人がその部屋に集合するのがPhotonでは簡単だと思います。<br>
下記のスクリプトを作成してください。<br>
※　nameTableは面倒臭いだけなので下にコピー用があります。<br>
TitleManager<br>
<img src="Image/Photon/TitleManager1.png"><br>
<img src="Image/Photon/TitleManager2.png"><br>
<img src="Image/Photon/TitleManager3.png"><br>
<img src="Image/Photon/TitleManager4.png"><br>

~~~ clike
readonly string[] nameTable = new string[]
{
    // 普通っぽい名（ツッコミ・常識人枠）
    "ソウタ", "ユウト", "ハルト", "リク", "カナタ", "ユウマ", "レオ", "リョウタ", "タクミ", "コウタ",
    "ミナ", "リナ", "ユイ", "ミオ", "ナナ", "モモ", "アヤネ", "ミク", "ホノカ", "ヒナ",

    // クソガキネーム（元気・あだ名系）
    "ユウキング", "リクトマン", "リョータロー", "ケンゴー", "タイガー", "ハルトZ", "ショウ様", "ユウダイMAX", "タクゾー", "アオレンジャー",
    "ミクティ", "ナナピ", "モモッチ", "ユイポン", "ヒナたん", "マリン☆", "リナちん", "ハルル", "カナぽん", "ユメっち",

    // アニメ・ゲームネタ混ぜ系
    "ゴクウ", "ルフィ", "ナルト", "カカシ", "キリト", "アスナ", "レム", "ラム", "ミカサ", "エレン",
    "デク", "バクゴー", "トドロキ", "イヌヤシャ", "カゴメ", "ルルーシュ", "C.C.", "アーニャ", "ヨル", "ロイド",

    // ネタ混じり（中二病・配信者・痛い系）
    "ダークネス竜牙", "リクト・ブラッドソウル", "タイガ＝インフェルノ", "ゼロX", "カズマックス", "ショウ・ザ・エッジ", "リュウジンΩ", "トウマ＝クロノス", "ハヤトン", "レン＝スカーレット",
    "アヤネ＝リバース", "ルナティック・ユイ", "ミナ・アルファ", "ノゾミ＝ステラ", "リサ・セイバー", "マリン＝トリニティ", "ヒナ・クリムゾン", "ミク・エクリプス", "ユメ＝ヴァルキリー", "モモンガDX",

    // ネタ・パロ・ネットミーム枠
    "マリオ", "ルイージ", "カービィ", "ピカチュウ", "リザードン", "ソニック", "メタナイト", "クラウド", "セフィロス", "スネーク",
    "アスカ", "シンジ", "レイ", "カヲル", "キョン", "ハルヒ", "長門", "古泉", "コナン", "ルパン",
    "悟飯", "ベジータ", "フリーザ", "ミサト", "エレン・イェーガー", "メグミン", "アクア", "カズマ", "ダクネス", "ターボー"
};
~~~
<br>

作成できたらTitleシーンのTitleManagerにアタッチしてください。<br>

# 何を同期するのか
同期しているオブジェクトを作成するにはいつもとは違う方法で作成する必要があります。<br>
下記のスクリプトを作成して、MainSceneのMainManagerにアタッチしてください。<br>

<img src="Image/Photon/MainManager1.png"><br>
<img src="Image/Photon/MainManager2.png"><br>

# Photonにおける同期のやり方
TestSceneにプレイヤーのプレハブがいっぱい置いてあると思います。<br>
このプレハブを開いてみると、PhotonView、PhotonTransformViewなどがあると思います。<br>
<img src="Image/Photon/PhotonView.png"><br>
<br>
これがPhotonにおける同期のやり方になります。<br>
他にもPhoton〇〇Viewがあるのですが、他のPCにも共有したいものにこれをつけ、<br>
先ほどのプログラムのPhotonNetwork.Instantiate()で生成することで、共有できます。<br>

# プログラム面での同期処理
皆さんが普通にプログラムを書くと基本的には、自分のパソコンでしか反映されません。<br>
他の人にも処理を加えたい場合はそれ専用の書き方をする必要があります。<br>

PlayerHit.csを見てみましょう。<br>
[PunRPC]とついた関数【HitRPC】が一番したにあり、<br>
それを呼び出すコードが41行目くらいにあると思います。<br>
photon.RPC(nameof(HitRPC), RpcTarget.Others);<br>

このRPCを扱う事で他の人のパソコンでも処理する事ができます。<br>

# 誰が処理するのか
さっきのRPCのプログラムには注意点が2つあります。<br>
・みんながみんなを呼び出して、多重に呼び出される<br>
・悪意のある呼び出し<br>
これらを解決する方法として大きく２つあります。<br>
1.当事者しか処理をしない<br>
→サーバーの処理は小さいが、無敵チートがやりたい放題<br>
2.サーバーしか処理をしない<br>
→サーバーの負荷増大だが、チートしにくい。<br>